export interface Env {
  DB: D1Database;
  JWT_SECRET: string;
  ADMIN_USER_IDS: string;
  ADMIN_API_KEY: string;
  GITHUB_PAT: string;
}

export interface User {
  user_id: string;
  full_name: string;
  first_name: string;
  last_name: string;
  password_hash: string | null;
  profile_image: string | null;
  role: 'admin' | 'participant';
  registered_at: string;
}

export interface Challenge {
  week: number;
  status: 'not_started' | 'started' | 'ended';
  start_time: string | null;
  end_time: string | null;
  started_by: string | null;
}

export interface PersonalTimer {
  user_id: string;
  week: number;
  started_at: string;
  status: 'in_progress' | 'submitted';
}

export interface Submission {
  id: number;
  user_id: string;
  week: number;
  submission_number: number;
  github_url: string;
  submitted_at: string;
  /** Total elapsed time in seconds since personal timer start. */
  elapsed_seconds: number;
  /** Equals elapsed_seconds / 60. Kept for backward compatibility. */
  elapsed_minutes: number;
  personal_start_time: string | null;
  global_start_time: string | null;
  /** Auto-generated by DB DEFAULT. Not set by application code. */
  created_at: string;
}

export interface Evaluation {
  id: number;
  user_id: string;
  week: number;
  submission_number: number;
  rubric_score: number;
  time_rank: number;
  time_rank_bonus: number;
  total_score: number;
  feedback: string;
  strengths: string | null;
  improvements: string | null;
  status: 'pending_review' | 'completed' | 'error';
  evaluated_at: string | null;
  evaluated_by: string | null;
  breakdown: string | null;
}

export interface JwtPayload {
  user_id: string;
  full_name: string;
  first_name: string;
  last_name: string;
  role: string;
}

export type AppVariables = { user: JwtPayload | null };
